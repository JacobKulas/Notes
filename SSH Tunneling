SSH Architecture

    Client vs Server vs Session

    Keys:

        User Key - Asymmetric public key used to identify the user to the server

        Host Key - Asymmetric public key used to identify the server to the user

        Session Key - Symmetric key created by the client and server to protect the sessionâ€™s communication.
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Configuration Files

    Client Configuration File (/etc/ssh/ssh_config)

    Server Configuration File (/etc/ssh/sshd_config)

    Known Hosts File (~/.ssh/known_hosts)
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
SSH First Connect

student@internet-host:~$ ssh student@172.16.82.106
The authenticity of host '172.16.82.106 (172.16.82.106)' can't be established.
ECDSA key fingerprint is SHA256:749QJCG1sf9zJWUm1LWdMWO8UACUU7UVgGJIoTT8ig0.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '172.16.82.106' (ECDSA) to the list of known hosts.
student@172.16.82.106's password:
student@blue-host-1:~$

    You will need to approve the Server Host (Public) Key

    Key is saved to /home/student/.ssh/known_hosts
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
SSH Re-Connect

ssh student@172.16.82.106
student@172.16.82.106's password:
student@blue-host-1:~$

    Further SSH connections to server will not prompt to save key as long as key does not change
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
SSH Host key Changed

ssh student@172.16.82.106
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now (man-in-the-middle attack)!
It is also possible that a host key has just been changed.
The fingerprint for the ECDSA key sent by the remote host is
SHA256:RO05vd7h1qmMmBum2IPgR8laxrkKmgPxuXPzMpfviNQ.
Please contact your system administrator.
Add correct host key in /home/student/.ssh/known_hosts to get rid of this message.
Offending ECDSA key in /home/student/.ssh/known_hosts:1
remove with:
ssh-keygen -f "/home/student/.ssh/known_hosts" -R "172.16.82.106"
ECDSA host key for 172.16.82.106 has changed and you have requested strict checking.
Host key verification failed.
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
SSH Port Forwarding

    Creates channels using SSH-CONN protocol

    Allows for tunneling of other services through SSH

    Provides insecure services encryption
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
SSH Options

    -L - Creates a port on the client (OG device) mapped to a ip:port via the server (For COSC this should on be on the internet host)

    -D - Creates a port on the client and sets up a SOCKS4 proxy tunnel where the target ip:port is specified dynamically (Only make these from the Internet host to the next device you need to scan with)

    -R - Creates the port on the server(device you had to login to when you ran ssh) mapped to a ip:port via the client

    -NT - Do not execute a remote command and disable pseudo-tty (will hang window) (This prevents accidentally closing all your port forwarding by reventing you from making it all a single tunnel)
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Local Port Forwarding

ssh -p <optional alt port> <user>@<server ip> -L <local bind port>:<tgt ip>:<tgt port> -NT

or

ssh -L <local bind port>:<tgt ip>:<tgt port> -p <alt port> <user>@<server ip> -NT
ssh <user>@<IP> -L <bind port>:<tgt ip>:<tgt port>
                    ^^^^^^^^^ This port opens on the device running the command
BIND RANGE: 51400-51499
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
You fucked up and did a telnet off a proxy
now make a static ssh tunnel from IH to james-host using a local port forward to 23
Now telnet to damian
then make a remote port forward to get traffic from james to damian:22
banner grab nc 127.0.0.1 to tunnel port
Now ssh should be properly working to damian
ssh user@loopback -p <inital tunnel port>

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
